CKEDITOR.plugins.add("fontAssist",{init:function(a){a.addCommand("fontAssistDialog",new CKEDITOR.dialogCommand("fontAssistDialog"));var b=a.lang.fontassist;if(!b){b=CKEDITOR.lang["default"]["fontassist"]}a.ui.addButton("FontAssist",{label:b.ToolTip,command:"fontAssistDialog",icon:this.path+"images/fonts.png"});CKEDITOR.dialog.add("fontAssistDialog",function(e){var v;var r;var j=false;var p={fg:"",bg:"",font_style:"",font:"",font_size:"",start:"&lt;",close:"&gt;",save_color:function(y,x){this[y]=x},get:function(x){return this[x]},save_font:function(x){this["font"]=x},save_size:function(x){this["font_size"]=x},get_font_style:function(y){var x=y?"/":" ";return this["font_size"]+x+this["font"]},open_tag:function(){return this.start+"font "+this.get_font_style(true)+";;"+this.get("fg")+";;"+this.get("bg")+this.close},close_tag:function(){return this.start+"/font"+this.close},};var c={fg:"",bg:"",font:"",font_size:"",};var f=function(y,A,z){var x=y.getContentElement(A,z).getInputElement().$.id;return document.getElementById(x)};var i=function(y){var x=f(y,"general","alert");x.value=p.open_tag();x.value=x.value.replace(/&lt;/,"<");x.value=x.value.replace(/&gt;/,">")};var d=function(y,x){var C=(x=="colors")?"fg":"bg";var z=f(y,x,C);p.save_color(C,z.value);var z=f(y,"general","contents");if(C=="fg"){z.style.color=p.get(C);var A=f(y,"general","contents");A.innerHTML=t(r)}else{z.style.backgroundColor=p.get(C)}y.enableButton("ok");y.selectPage("general");i(y)};var l=function(x){p.save_color("fg",c.fg);p.save_color("bg",c.bg);var y=f(x,"general","contents");y.style.color=p.get("fg");y.style.backgroundColor=p.get("bg");y.innerHTML=t(r);i(x)};var s=function(x){var y=p.get_font_style(false);var z=f(x,"general","contents");z.style.font=y;z.innerHTML=t(r);i(x)};var n=function(x){p.save_font(c.font);p.save_size(c.font_size);s(x);var y=f(x,"general","fontopts");y.options[0].selected=true;y=f(x,"general","sizeopts");y.options[0].selected=true};var w=function(x,A){var y=this.getDialog();y.disableButton("ok");var C=f(y,"colors","fg");var z=m(x,C);var C=f(y,"colors","fgsample");C.style.backgroundColor=z;u(y,true)};var o=function(x,A){var y=this.getDialog();y.disableButton("ok");var C=f(y,"backgroundcolors","bg");var z=m(x,C);var C=f(y,"backgroundcolors","bgsample");C.style.backgroundColor=z;u(y,true)};var m=function(x,D){var C=x.data.getTarget(),z=C.getName();if(z!="td"){return}var y=C.getAttribute("style").split(/#/);var A=C.getAttribute("style").match(/(#[A-Z0-9]+);/);if(!A){A=C.getAttribute("style").match(/(rgb\([,\s\d]+\))/)}else{A[1]=q(A[1])}D.value=A[1];return A[1]};var u=function(y,z){var x=f(y,"general","oktoggle");x.checked=z};var q=function(C){var y=function(D){return parseInt((z(D)).substring(0,2),16)};var x=function(D){return parseInt((z(D)).substring(2,4),16)};var A=function(D){return parseInt((z(D)).substring(4,6),16)};var z=function(D){return(D.charAt(0)=="#")?D.substring(1,7):D};R=y(C);G=x(C);B=A(C);return"rgb("+R+", "+G+", "+B+")"};var h=function(A,z){for(var y=0;y<z.length;y++){var x=z[y].split("/");A.options[A.options.length]=new Option(x[0],x[1])}};var g=function(A,z){for(var x=0;x<A.options.length;x++){var y=new RegExp(A.options[x].label,"i");if(z.match(y)){A.options[x].selected=true;break}}};function k(){if(v){return v.join("")}v=['<div style="width:90%;margin:auto; height: 400px; overflow:auto;">','<style type="text/css">#c_chart td { height: 16px; width: 16px; border: 2px solid white; }</style>','<table  id = "c_chart"  style="border:2px solid white;" cellspacing="2" cellpadding="2"><tbody><tr>'];var z=e.config.colors;for(var x=0;x<z.length;x++){if(x%26==0){v.push("<tr>")}v.push('<td style="background-color: #'+z[x]+';" title= #"'+z[x]+'"></td>')}v.push("</tbody></table></div>");var y=v.join("");return y}function t(x){x=x.replace(/<(b|i|em|u|strong|sup|sub|code)>/g,function(y,I){var z=p.get_font_style(false),F=p.get("fg"),A=p.get("font"),H=p.get("font_size");var D="";var E="";switch(I){case"b":case"strong":D="; font-weight: bold; ";break;case"i":case"em":D="; font-style: italic; ";break;case"u":D="; text-decoration:underline; ";break;case"sup":var C=parseInt(H);C=parseInt(C*0.75);D="; vertical-align:super; ";E=C+"pt "+A;break;case"sub":var C=parseInt(H);C=parseInt(C*0.75);D="; vertical-align: sub; ";E=C+"pt "+A;break;case"code":F="black";D="; background-color: white; ";break}return"<"+I+" style='color:"+F+"; font: "+(E?E:z)+D+"'>"});return x}return{title:b.Title,minWidth:440,minHeight:480,contents:[{id:"general",label:b.Main,elements:[{type:"html",html:b.MainHeader,},{type:"html",html:'<div style="max-width:400px;  white-space: pre-wrap;border:1px solid black; margin:auto; height: 300px; overflow:auto;"></div>',id:"contents",label:b.Text,},{type:"text",id:"alert",onClick:function(){var x=this.getDialog();var y=f(x,"general","alert");y.focus();y.select()},},{id:"oktoggle",label:b.IfChecked,type:"checkbox","default":false,onChange:function(){var x=this.getDialog();x.enableButton("ok");u(x,false)},},{type:"hbox",children:[{type:"select",id:"fontopts",label:b.Fonts,items:[["< "+b.none+" >",""]],onChange:function(){p.save_font(this.getValue());s(this.getDialog())},commit:function(x){x.style=this.getValue()}},{type:"select",id:"sizeopts",label:b.FontSizes,items:[["< "+b.none+" >",""]],onChange:function(){p.save_size(this.getValue());s(this.getDialog())},commit:function(x){x.style=this.getValue()}},]},{type:"hbox",children:[{type:"button",label:b.ResetFont,onClick:function(){n(this.getDialog())},},{type:"button",label:b.ResetAll,onClick:function(){var x=this.getDialog();n(x);l(x)},},]},]},{id:"colors",label:b.TextColors,elements:[{type:"html",html:b.SelectColor,},{id:"textcolors",type:"html",html:k(),onClick:w},{type:"hbox",widths:["40%","10%","25%","25%"],children:[{type:"text",id:"fg",width:"12em",label:b.SelectedTextColor,commit:function(x){x.fg=this.getValue()}},{type:"html",id:"fgsample",html:'<table style="border: 1px solid silver;"><tr><td style="width:24px;">&nbsp;</td><tr></table>',},{type:"button",id:"fgb_confirm",label:b.Accept,onClick:function(){var x=this.getDialog();d(x,"colors");x.enableButton("ok");u(x,false)},},{type:"button",id:"fgb_reset",label:b.Reset,onClick:function(){var x=this.getDialog();var y=f(x,"colors","fg");y.value="";x.enableButton("ok");u(x,false)},},],}],},{id:"backgroundcolors",label:b.BGColors,elements:[{type:"html",html:b.SelectColor,},{id:"bgcolors",type:"html",html:k(),onClick:o},{type:"hbox",widths:["40%","10%","25%","25%"],children:[{type:"text",id:"bg",width:"12em",label:b.SelectedBGColor,commit:function(x){x.fg=this.getValue()}},{type:"html",id:"bgsample",html:'<table style="border: 1px solid silver;"><tr><td style="width:24px;">&nbsp;</td><tr></table>',},{type:"button",id:"bgb_confirm",label:b.Accept,onClick:function(){var x=this.getDialog();d(x,"backgroundcolors");x.enableButton("ok");u(x,false)},},{type:"button",id:"bgb_reset",label:b.Reset,onClick:function(){var x=this.getDialog();var y=f(x,"backgroundcolors","bg");y.value="";x.enableButton("ok");u(x,false)},},],},],},{id:"info",label:"Info",elements:[{type:"html",html:b.InfoText,}],}],onShow:function(){var H=this.getParentEditor(),L=H.getSelection();j=false;var K=f(this,"general","alert");K.innerHTML="";this.enableButton("ok");var A=L.getSelectedText();var F=L.getRanges(true)[0];F.shrink(CKEDITOR.SHRINK_TEXT);var J=F.getCommonAncestor();var y=J.getAscendant("p",true);if(!y){return}if(!A.match(/&lt;font(.*)\/font&gt;/)&&!A.match(/<font(.*)\/font>/)){j=true;var K=f(this,"general","alert");K.value="Changes will not be inserted into editor.  See Info for details"}text=y.getHtml();if(!text&&j){if(A){text=A}}text=text.replace(/&lt;/g,"<");text=text.replace(/&gt;/g,">");text=text.replace(/<span.*?scayt.*?>(.*?)<\/span>/g,"$1");var I=f(this,"general","contents");var E=text.match(/<font(.*?)>(.*)/m);if(E&&E[2]){var x=E[1].split(/;;/);I.style.color=x[1];I.style.backgroundColor=x[2];p.save_color("fg",x[1]);p.save_color("bg",x[2]);c.fg=x[1];c.bg=x[2];var C=x[0].split("/");var D=C[0]+" "+C[1];I.style.font=D;p.save_size(C[0]);p.save_font(C[1]);c.font=C[1];c.font_size=C[0];E[2]=E[2].replace(/<\/font>/,"");E[2]=E[2].replace(/<br\/?>/," ");r=E[2];I.innerHTML=t(E[2]);var z=f(this,"general","fontopts");g(z,c.font);z=f(this,"general","sizeopts");g(z,c.font_size)}},onLoad:function(){e=this.getParentEditor();var C=f(this,"general","fontopts");var A=CKEDITOR.config.font_names.split(/;/);h(C,A);var C=f(this,"general","sizeopts");var x=CKEDITOR.config.fontSize_sizes.split(/;/);h(C,x);var z=this._.tabs.general&&this._.tabs.general[0];var y=this;z.on("focus",function(D){y.enableButton("ok");var E=f(y,"general","oktoggle");E.checked=false})},onOk:function(){if(j){return}var y=e.document.createElement("p");var x=p.open_tag()+r+p.close_tag();y.setHtml(x);e.insertElement(y)}}})}});