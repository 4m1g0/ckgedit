var update_ckgeditInternalLink,update_ckgeditMediaLink;var fckgInternalInputId,fckgMediaInputId,ckgeditIwikiData,ckgeditIwikiIndex,ckgeditInternalText;var ck_m_files_protocol,ckg_dialog;window.onbeforeunload=function(){};CKEDITOR.dialog.add("link",function(aO){oDokuWiki_FCKEditorInstance.Lang=aO.lang;ck_m_files_protocol=oDokuWiki_FCKEditorInstance.mfiles?["m-files://\u200E","m-files://"]:"";var ar=oDokuWiki_FCKEditorInstance.dwiki_doku_base;var X=CKEDITOR.plugins.link;var aK=new Object();aK.doku_base=new RegExp("^"+ar.replace(/\//g,"\\/"),"g");aK.media_internal=/lib\/exe\/fetch\.php\/(.*)/;aK.media_rewrite_1=/^_media\/(.*)/;aK.media_rewrite_1Doku_Base=new RegExp("^"+ar+"_media/(.*)");aK.media_rewrite_2=/exe\/fetch.php\?media=(.*)/;aK.internal_link=/doku.php\?id=(.*)/;aK.internal_link_rewrite_2=/doku.php\/(.*)/;aK.internal_link_rewrite_1=new RegExp("^"+ar+"(?!_media)(.*)");aK.samba=/file:\/\/\/\/\/(.*)/;aK.interwiki=/^(.*?)oIWIKIo(.*?)cIWIKIc/;aK.samba_unsaved=/^\\\\\w+(\\\w.*)/;ckg_dialog=CKEDITOR.dialog;var an;var ah={InternalLink:"internal link",LinkText:"Link Text (Optional)",InternalMedia:"internal media",MediaFileLink:"link to media file",SMBLabel:"Samba Share",GetHeadingsLabel:"Get Headings",QStringLabel:"Query String (For example: value_1=1&value_2=2) ",ResetQS:"Reset Query String",NotSetOption:"Not Set",AdvancedInfo:"To create anchors from Dokuwiki headers, click on the Get Headings button, select the header, click OK. You can go back, select a new page and get new headers.",AdvancedTabPrompt:"Use the advanced tab to create page anchors and query strings",SMBExample:"Enter your share as: \\\\Server\\directory\\file",InterWikiLink:"Interwiki Link",InterWikiType:"Interwiki Type",InterwikiPlaceHolder:"Interwiki Replacement Text",InterwikiInfo:"<div style='max-width:350px; white-space: pre-wrap;border:1px solid #cccccc; margin:auto; overflow:auto; padding:4px;line-height:125%;'>Dokuwiki's interwiki links are short-cuts which look like this: <span style='font-weight:600'>[[wp&gt;Shakespeare]]</span>, which will create a link to the English Wikipedia article on Shakespeare.  The <span style='font-weight:600'>wp</span> part designates a link pattern;  the text following the '<span style='font-weight:900'>&gt;</span>' will be inserted into the link, replacing  a place holder, which is enclosed in curly brackets, as in <span style='font-weight:600'>{NAME}</span>. When there is no place holder, the replacement text will be appended to the end of the link.</div>",MediaFileLink:"link to media file"};var ay=aO.lang.fbrowser?aO.lang.fbrowser:ah;var aH=function(a){if(ay[a]&&ay[a]!=""){return ay[a]}return ah[a]};var aF=function(){var a;jQuery.ajax(DOKU_BASE+"lib/exe/ajax.php",{data:{call:"iwiki_list"},type:"POST",async:true,dataType:"json",success:function(d,c,b){a=d;ckgeditIwikiData=a},error:function(b,c,d){alert(c);alert(d)}});return a};var Z=function(){var e=this.getDialog();var d=e.getContentElement("advanced","internalAnchor").getInputElement().$.id;var b=document.getElementById(d);var f=e.getContentElement("info","internal").getInputElement().$.id;f=document.getElementById(f).value;if(!f){return}var a={push:function(g,h){this.stack[this.Index]=(new Option(g,h,false,false));this.Index++},Index:0,stack:undefined,selection:"",ini:function(g){this.stack=b.options;this.stack.length=0;this.Index=0;this.push(g,"")}};var c="dw_id="+f;aO.config.jquery.post(aO.config.ckedit_path+"get_headers.php",c,function(h,m){if(m=="success"){var g=decodeURIComponent(h);if(g.match(/^\s*__EMPTY__\s*$/)){a.ini("No Headers Found");a.selection="";return}a.ini("Headings Menu");var j=g.split("@@");for(var k in j){var l=j[k].split(/;;/);a.push(l[0],l[1])}}},"html")};var ae=function(a){var d=a;var b=0;var c="dw_id="+encodeURIComponent(a);aO.config.jquery.ajax({url:aO.config.ckedit_path+"useheading.php",async:true,data:c,type:"POST",dataType:"html",success:function(e){if(b){alert(e)}d=decodeURIComponent(e)},error:function(g,e,f){d=a}});return d};var W=function(){return an};var aA;var aD=function(){oDokuWiki_FCKEditorInstance.isLocalDwikiBrowser=false;oDokuWiki_FCKEditorInstance.isUrlExtern=false;oDokuWiki_FCKEditorInstance.isDwikiMediaFile=false;var f=this.getDialog(),c=["urlOptions","anchorOptions","emailOptions","internalOptions","mediaOptions","sambaOptions","interwikiOptions"],e=this.getValue(),d=f.definition.getContents("upload"),b=d&&d.hidden;f.hidePage("advanced");if(e=="internal"){oDokuWiki_FCKEditorInstance.isLocalDwikiBrowser=true;f.showPage("advanced")}else{if(e=="media"){oDokuWiki_FCKEditorInstance.isDwikiMediaFile=true}}if(e=="url"){oDokuWiki_FCKEditorInstance.isUrlExtern=true;if(!b){f.showPage("upload")}}else{if(!b){f.hidePage("upload")}}for(var g=0;g<c.length;g++){var a=f.getContentElement("info",c[g]);if(!a){continue}a=a.getElement().getParent().getParent();if(c[g]==e+"Options"){a.show()}else{a.hide()}}f.layout()};var af=/^javascript:/,ad=/^mailto:([^?]+)(?:\?(.+))?$/,aI=/subject=([^;?:@&=$,\/]*)/,V=/body=([^;?:@&=$,\/]*)/,av=/^#(.*)$/,aN=/^((?:http|https|ftp|news|m-files):\/\/)?(.*)$/,au=/^(_(?:self|top|parent|blank))$/,aB=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,ai=/^javascript:([^(]+)\(([^)]+)\)$/;var az=ar.replace("/","/")+"doku.php?id=(.*)$";var aP="/"+az+"/";var aE=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/;var ap=/(?:^|,)([^=]+)=(\d+|yes|no)/gi;var aC=function(b,e){var j=(e&&(e.data("cke-saved-href")||e.getAttribute("href")))||"",v,k,n,u,s={};if((v=j.match(af))){if(aG=="encode"){j=j.replace(aB,function(y,z,A){return"mailto:"+String.fromCharCode.apply(String,z.split(","))+(A&&aw(A))})}else{if(aG){j.replace(ai,function(H,F,z){if(F==ag.name){s.type="email";var G=s.email={};var B=/[^,\s]+/g,A=/(^')|('$)/g,C=z.match(B),E=C.length,I,D;for(var y=0;y<E;y++){D=decodeURIComponent(aw(C[y].replace(A,"")));I=ag.params[y].toLowerCase();G[I]=D}G.address=[G.name,G.domain].join("@")}})}}}if(!s.type){var m=e?e.getAttribute("class"):"";if((n=j.match(av))){s.type="anchor";s.anchor={};s.anchor.name=s.anchor.id=n[1]}else{if((k=j.match(ad))){var t=j.match(aI),r=j.match(V);s.type="email";var p=(s.email={});p.address=k[1];t&&(p.subject=decodeURIComponent(t[1]));r&&(p.body=decodeURIComponent(r[1]))}else{if((u=j.match(aK.media_internal))||(u=j.match(aK.media_rewrite_1))||(u=j.match(aK.media_rewrite_2))||(u=j.match(aK.media_rewrite_1Doku_Base))){s.type="media";s.url={};s.url.protocol="";s.url.url="";s.url.selected=u[1]}else{if((u=j.match(aP))||(u=j.match(aK.internal_link_rewrite_2))||(u=j.match(aK.internal_link_rewrite_1))){s.type="internal";s.url={};var c=u[1].split("=");s.url.selected=c[1];s.url.protocol="";s.url.url=""}else{if(u=j.match(aK.samba)){s.type="samba";s.url={};s.url.url="";s.url.protocol="";s.url.selected="\\\\"+u[1].replace(/\//g,"\\")}else{if(u=j.match(aK.samba_unsaved)){s.type="samba";s.url={};s.url.url="";s.url.protocol="";s.url.selected=u[0]}else{if(u=j.match(aK.interwiki)||m.match(/interwiki/)){var o="";if(u&&u[2]){o=decodeURIComponent(u[2])}s.url={};aA=e.getAttribute("class");var w=ckg_dialog.getContentElement("info","iwiki_shortcut");var h=w.getInputElement().$.id;var q=document.getElementById(h);var x=aA.match(/iw_([^\s]+)/);var a=x[1].replace(/_/,".");if(!o){var l=ckgeditIwikiData[a];l=l.replace(/\{\w+\}$/,"");var d=new RegExp(l+"(.*)");x=j.match(d);o=x[1]}a=ckgeditIwikiIndex[a];if(a){q.selectedIndex=a}else{q.selectedIndex="0"}w.disable();s.type="interwiki";s.url.selected=o;s.url.url=o}else{if(j&&(u=j.match(aN))){s.type="url";s.url={};s.url.protocol=u[1];s.url.url=u[2]}else{s.type="url"}}}}}}}}}if(e){var f=e.getAttribute("target");s.target={};s.adv={};var g=this}this._.selectedElement=e;return s};var am=function(a){if(!a){return}document.getElementById(fckgInternalInputId).disabled=true;document.getElementById(fckgInternalInputId).style.fontWeight="bold";document.getElementById(fckgInternalInputId).style.backgroundColor="#DDDDDD";a=a.replace(/^[\/\:]/,"");a=a.replace(/\//g,":");a=":"+a;document.getElementById(fckgInternalInputId).value=a};update_ckgeditInternalLink=am;var aM=function(a){if(!a){return}a=a.replace(/^[\/\:]/,"");a=a.replace(/\//g,":");a=":"+a;document.getElementById(fckgMediaInputId).value=a};update_ckgeditMediaLink=aM;var ax=function(a){for(i in a){msg=i+"="+a[i];if(!confirm(msg)){break}}};var aq=function(a,b){if(b[a]){this.setValue(b[a][this.id]||"")}};var ab=function(a){return aq.call(this,"target",a)};var ac=function(a){return aq.call(this,"adv",a)};var Y=function(a,b){if(!b[a]){b[a]={}}b[a][this.id]=this.getValue()||""};var ao=function(a){return Y.call(this,"target",a)};var aa=function(a){return Y.call(this,"adv",a)};function aw(a){return a.replace(/\\'/g,"'")}function al(a){return a.replace(/'/g,"\\$&")}var aG=aO.config.emailProtection||"";if(aG&&aG!="encode"){var ag={};aG.replace(/^([^(]+)\(([^)]+)\)$/,function(b,a,c){ag.name=a;ag.params=[];c.replace(/[^,\s]+/g,function(d){ag.params.push(d)})})}function aL(g){var b,a=ag.name,c=ag.params,e,d;b=[a,"("];for(var f=0;f<c.length;f++){e=c[f].toLowerCase();d=g[e];f>0&&b.push(",");b.push("'",d?al(encodeURIComponent(g[e])):"","'")}b.push(")");return b.join("")}function at(a){var b,c=a.length,e=[];for(var d=0;d<c;d++){b=a.charCodeAt(d);e.push(b)}return"String.fromCharCode("+e.join(",")+")"}function aj(a){var b=a.getAttribute("class");return b?b.replace(/\s*(?:cke_anchor_empty|cke_anchor)(?:\s*$)?/g,""):""}var ak=aO.lang.common,aJ=aO.lang.link;return{title:aJ.title,minWidth:375,minHeight:250,contents:[{id:"info",label:aJ.info,title:aJ.info,elements:[{id:"linkType",type:"select",label:aJ.type,"default":"url",items:[[aJ.toUrl,"url"],[aH("InternalLink"),"internal"],[aH("InternalMedia"),"media"],[aJ.toEmail,"email"],[aH("SMBLabel"),"samba"],[aH("InterWikiLink"),"interwiki"]],onChange:aD,setup:function(a){if(a.type){this.setValue(a.type)}},commit:function(a){a.type=this.getValue()}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:ak.protocol,"default":"http://",items:[["http://\u200E","http://"],["https://\u200E","https://"],["ftp://\u200E","ftp://"],["news://\u200E","news://"],ck_m_files_protocol],setup:function(a){if(a.url){this.setValue(a.url.protocol||"")}},commit:function(a){if(!a.url){a.url={}}a.url.protocol=this.getValue()}},{type:"text",id:"url",label:ak.url,required:true,onLoad:function(){this.allowOnChange=true},onKeyUp:function(){this.allowOnChange=false;var e=this.getDialog().getContentElement("info","protocol"),b=this.getValue(),a=/^(http|https|ftp|news|m-files):\/\/(?=.)/i,c=/^((javascript:)|[#\/\.\?])/i;var d=a.exec(b);if(d){this.setValue(b.substr(d[0].length));e.setValue(d[0].toLowerCase())}else{if(c.test(b)){e.setValue("")}}this.allowOnChange=true},onChange:function(){if(this.allowOnChange){this.onKeyUp()}},validate:function(){var b=this.getDialog();if(b.getContentElement("info","linkType")&&b.getValueOf("info","linkType")!="url"){return true}if(this.getDialog().fakeObj){return true}var a=CKEDITOR.dialog.validate.notEmpty(aJ.noUrl);return a.apply(this)},setup:function(a){this.allowOnChange=false;if(a.url){this.setValue(a.url.url)}this.allowOnChange=true},commit:function(a){this.onChange();if(!a.url){a.url={}}a.url.url=this.getValue();this.allowOnChange=false}}],setup:function(a){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().show()}}}]},{type:"vbox",id:"internalOptions",children:[{type:"button",id:"browse1",hidden:"true",filebrowser:"info:url",label:ak.browseServer},{type:"text",id:"internal",label:aH("InternalLink"),required:true,setup:function(b){if(b){if(b.url&&b.url.selected){var a=b.url.selected.replace(/^\:/,"");this.setValue(":"+a)}}}},{type:"text",id:"internal_text",label:aH("LinkText"),required:false},{id:"anchorsmsg",type:"html",html:aH("AdvancedTabPrompt")}]},{type:"vbox",id:"interwikiOptions",children:[{type:"text",id:"interwiki",label:aH("InterwikiPlaceHolder"),required:true,setup:function(b){if(b){if(b.url&&b.url.selected){var a=b.url.selected.replace(/^\:/,"");this.setValue(a)}}},commit:function(a){if(!a.url){a.url={}}a.url.selection=this.getValue()}},{id:"iwiki_shortcut",type:"select",label:aH("InterWikiType"),"default":"",items:[["Not Set","Not-Set"]],setup:function(a){if(a.url){this.setValue(a.url.iwiki_shortcut||"")}},commit:function(a){if(!a.url){a.url={}}a.url.iwiki_shortcut=this.getValue()}},{id:"iwikimsg",type:"html",html:aH("InterwikiInfo")}]},{type:"vbox",id:"mediaOptions",children:[{type:"button",id:"browse2",filebrowser:"info:url",label:ak.browseServer},{type:"text",id:"media",label:aH("MediaFileLink"),required:true,setup:function(b){if(b){if(b.url&&b.url.selected){var a=b.url.selected.replace(/^\:/,"");this.setValue(":"+a)}}}}]},{type:"vbox",id:"sambaOptions",children:[{type:"html",id:"smb_msg",html:aH("SMBExample")},{type:"text",id:"samba",width:"50",label:aH("SMBLabel"),required:true,setup:function(a){if(a.url&&a.url.selected){this.setValue(a.url.selected)}}}]},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:aJ.emailAddress,required:true,validate:function(){var b=this.getDialog();if(!b.getContentElement("info","linkType")||b.getValueOf("info","linkType")!="email"){return true}var a=CKEDITOR.dialog.validate.notEmpty(aJ.noEmail);return a.apply(this)},setup:function(a){if(a.email){this.setValue(a.email.address)}var b=this.getDialog().getContentElement("info","linkType");if(b&&b.getValue()=="email"){this.select()}},commit:function(a){if(!a.email){a.email={}}a.email.address=this.getValue()}},{type:"text",id:"emailSubject",label:aJ.emailSubject,setup:function(a){if(a.email){this.setValue(a.email.subject)}},commit:function(a){if(!a.email){a.email={}}a.email.subject=this.getValue()}},{type:"textarea",id:"emailBody",label:aJ.emailBody,rows:3,"default":"",setup:function(a){if(a.email){this.setValue(a.email.body)}},commit:function(a){if(!a.email){a.email={}}a.email.body=this.getValue()}}],setup:function(a){if(!this.getDialog().getContentElement("info","linkType")){this.getElement().hide()}}}]},{id:"upload",label:aJ.upload,title:aJ.upload,hidden:true,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:ak.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:ak.uploadSubmit,filebrowser:"info:url","for":["upload","upload"]}]},{id:"advanced",label:aJ.advanced,title:aJ.advanced,elements:[{id:"msg",type:"html",html:"<p style='max-width:350px; white-space: pre-wrap;'>"+aH("AdvancedInfo")+"</p>"},{id:"internalAnchor",type:"select","default":"",items:[["Not Set",""]],setup:function(a){if(a.hash){this.setValue(a.hash)}},commit:function(a){a.hash=this.getValue()}},{type:"button",id:"getheaders",onClick:Z,label:aH("GetHeadingsLabel")},{type:"html",html:"<br />"},{type:"text",id:"queryString",label:aH("QStringLabel"),setup:function(a){if(a.qstring){this.setValue(a.qstring)}},commit:function(a){a.qstring=this.getValue()}},{type:"button",id:"clearquerystring",onClick:function(){var a=this.getDialog();var c=a.getContentElement("advanced","queryString").getInputElement().$.id;var b=document.getElementById(c);b.value=""},label:aH("ResetQS")},{type:"vbox",padding:1,hidden:true,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:aJ.cssClasses,"default":"",id:"advCSSClasses",setup:ac,commit:aa},{type:"text",label:aJ.charset,"default":"",id:"advCharset",setup:ac,commit:aa}]}]}]}],onShow:function(){var c=this.getParentEditor(),a=c.getSelection(),b=null;if((b=X.getSelectedLink(c))&&b.hasAttribute("href")){a.selectElement(b)}else{b=null}this.setupContent(aC.apply(this,[c,b]))},onOk:function(){var h=false;var D=new RegExp(oDokuWiki_FCKEditorInstance.imageUploadAllowedExtensions);var B={},I=[],t={},f=this,G=this.getParentEditor();this.commitContent(t);var m=false;var A="";switch(t.type||"url"){case"media":if(document.getElementById(fckgMediaInputId).value){t.url.url=document.getElementById(fckgMediaInputId).value}t.adv.advTitle=t.url.url;var g=t.url.url.match(/(\.(\w+))$/);A=t.url.url.replace(/^:/,"");t.url.url=top.dokuBase+"doku.php?id="+t.url.url;if(g[1].match(D)){t.adv.advContentType="linkonly"}else{t.adv.advContentType="other_mime";t.url.url=top.dokuBase+"lib/exe/fetch.php?media="+A;m=true}t.adv.advCSSClasses="media mediafile";if(g){t.adv.advCSSClasses+=" mf_"+g[2]}var v=(t.url&&t.url.protocol!=undefined)?t.url.protocol:"http://",F=(t.url&&CKEDITOR.tools.trim(t.url.url))||"";B["data-cke-saved-href"]=(F.indexOf("/")===0)?F:v+F;break;case"internal":h=document.getElementById(ckgeditInternalText).value?document.getElementById(ckgeditInternalText).value:false;if(!t.url.url){t.url.url=document.getElementById(fckgInternalInputId).value;if(!t.url.url.match(/^:\w+/)){var p=top.getCurrentWikiNS()+":";p=p.replace(/:$/,"");var a=new RegExp(":?"+p+":");if(!t.url.url.match(a)){t.url.url=p+":"+t.url.url;t.url.url=t.url.url.replace(/\:{2,}/g,":")}}}t.url.url=t.url.url.replace(/^.*?\/data\/pages\//,"");t.url.url=t.url.url.replace(/^\:/,"");t.url.url=":"+t.url.url.replace(/\//g,":");t.adv.advCSSClasses="wikilink1";if(oDokuWiki_FCKEditorInstance.useheading=="y"){t.adv.advTitle=ae(t.url.url)}else{t.adv.advTitle=t.url.url}t.url.url=top.dokuBase+"doku.php?id="+t.url.url;if(t.hash){t.url.url+="#"+t.hash}if(t.qstring){t.url.url+="&"+t.qstring}var v=(t.url&&t.url.protocol!=undefined)?t.url.protocol:"http://",F=(t.url&&CKEDITOR.tools.trim(t.url.url))||"";B["data-cke-saved-href"]=(F.indexOf("/")===0)?F:v+F;break;case"interwiki":if(aA){t.adv.advCSSClasses=aA}else{t.adv.advCSSClasses="interwiki iw_"+t.url.iwiki_shortcut}var l=ckgeditIwikiData[t.url.iwiki_shortcut];t.adv.advTitle=t.url.selection;if(t.url.selection){t.url.selection="oIWIKIo"+t.url.selection+"cIWIKIc"}if(l.match(/\{.*?\}/)){t.url.url=ckgeditIwikiData[t.url.iwiki_shortcut].replace(/{.*?}/,t.url.selection)}else{t.url.url=l+t.url.selection}B["data-cke-saved-href"]=t.url.url;break;case"url":var v=(t.url&&t.url.protocol!=undefined)?t.url.protocol:"http://",F=(t.url&&CKEDITOR.tools.trim(t.url.url))||"";B["data-cke-saved-href"]=(F.indexOf("/")===0)?F:v+F;break;case"anchor":var n=(t.anchor&&t.anchor.name),u=(t.anchor&&t.anchor.id);B["data-cke-saved-href"]="#"+(n||u||"");break;case"samba":if(!t.url.url){t.url.url=document.getElementById(W()).value}if(!t.url.url){alert("Missing Samba Url");return false}t.url.protocol="";var v="";F=(t.url&&CKEDITOR.tools.trim(t.url.url))||"";B["data-cke-saved-href"]=(F.indexOf("/")===0)?F:v+F;t.adv.advCSSClasses="windows";t.adv.advTitle=t.url.url;break;case"email":var b,r=t.email,H=r.address;switch(aG){case"":case"encode":var E=encodeURIComponent(r.subject||""),z=encodeURIComponent(r.body||"");var C=[];z&&C.push("body="+z);E&&C.push("subject="+E);C=C.length?"?"+C.join("&"):"";if(aG=="encode"){b=["javascript:void(location.href='mailto:'+",at(H)];C&&b.push("+'",al(C),"'");b.push(")")}else{b=["mailto:",H,C]}break;default:var s=H.split("@",2);r.name=s[0];r.domain=s[1];b=["javascript:",aL(r)]}B["data-cke-saved-href"]=b.join("");break}if(t.adv){var o=function(L,K){var J=t.adv[L];if(J){B[K]=J}else{I.push(K)}};o("advId","id");o("advLangDir","dir");o("advAccessKey","accessKey");if(t.adv.advName){B.name=B["data-cke-saved-name"]=t.adv.advName}else{I=I.concat(["data-cke-saved-name","name"])}o("advLangCode","lang");o("advTabIndex","tabindex");if(!m){o("advTitle","title")}o("advContentType","type");o("advCSSClasses","class");o("advCharset","charset");o("advStyles","style");o("advRel","rel")}var q=G.getSelection();var w=q.getSelectedText()?q.getSelectedText():false;B.href=B["data-cke-saved-href"];if(!this._.selectedElement){var c=q.getRanges(true);if(c.length==1&&c[0].collapsed){var x=new CKEDITOR.dom.text(t.type=="email"?t.email.address:B["data-cke-saved-href"],G.document);c[0].insertNode(x);c[0].selectNodeContents(x);q.selectRanges(c)}if(navigator.userAgent.match(/(Trident|MSIE)/)){var e=G.document.createElement("a");e.setAttribute("href",B.href);if(!w&&(t.type=="media"||t.type=="internal")){if(h){e.setHtml(h)}else{e.setHtml(t.adv.advTitle)}}else{e.setHtml(q.getSelectedText())}for(attr in B){if(attr.match(/href/i)){continue}e.setAttribute(attr,B[attr])}G.insertElement(e)}else{var j=new CKEDITOR.style({element:"a",attributes:B});j.type=CKEDITOR.STYLE_INLINE;j.apply(G.document)}}else{var d=this._.selectedElement,k=d.data("cke-saved-href"),y=d.getHtml();if(m){B.type="other_mime";B.title=":"+A}d.setAttributes(B);d.removeAttributes(I);if(t.adv&&t.adv.advName&&CKEDITOR.plugins.link.synAnchorSelector){d.addClass(d.getChildCount()?"cke_anchor":"cke_anchor_empty")}if(k==y||t.type=="email"&&y.indexOf("@")!=-1){d.setHtml(t.type=="email"?t.email.address:B["data-cke-saved-href"])}q.selectElement(d);delete this._.selectedElement}if(h){x.setText(h)}else{if(x&&t.adv.advTitle){x.setText(t.adv.advTitle)}}},onLoad:function(){aF();ckg_iwi_Select_Id_x=this.getContentElement("info","iwiki_shortcut").getInputElement().$.id;setTimeout(function(e){var h=document.getElementById(ckg_iwi_Select_Id_x);this.stack=h.options;this.stack.length=0;this.stack[0]=(new Option("Not Set","not-set",false,false));ckgeditIwikiIndex=new Array();var f=1;for(var g in ckgeditIwikiData){this.stack[f]=new Option(g+" >> "+ckgeditIwikiData[g],g,false,false);ckgeditIwikiIndex[g]=f;f++}},2000);oDokuWiki_FCKEditorInstance.isDwikiImage=false;fckgInternalInputId=this.getContentElement("info","internal").getInputElement().$.id;ckgeditInternalText=this.getContentElement("info","internal_text").getInputElement().$.id;fckgMediaInputId=this.getContentElement("info","media").getInputElement().$.id;an=this.getContentElement("info","samba").getInputElement().$.id;var d=this.getContentElement("info","iwiki_shortcut").getInputElement().$.id;this.getContentElement("info","media").disable();this.hidePage("advanced");this.showPage("info");ckg_dialog=this;var a=this._.tabs.advanced&&this._.tabs.advanced[0];var b=this;var c=aH("NotSetOption");a.on("focus",function(g){var e=b.getContentElement("advanced","internalAnchor").getInputElement().$.id;var f=document.getElementById(e);f.selectedIndex=-1;f.options.length=0;f.options[0]=new Option(c,"",false,false)})},onFocus:function(){var b=this.getContentElement("info","linkType"),a;if(b&&b.getValue()=="url"){a=this.getContentElement("info","url");a.select()}}}});