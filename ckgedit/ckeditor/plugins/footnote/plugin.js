CKEDITOR.plugins.add("footnote",{init:function(a){a.addCommand("footnoteDialog",new CKEDITOR.dialogCommand("footnoteDialog"));if(!oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj){oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj=new Object();oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes=new Array();oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.count=0}a.ui.addButton("Footnotes",{label:"Insert a footnote",command:"footnoteDialog",icon:this.path+"images/footnote.png"});CKEDITOR.dialog.add("footnoteDialog",function(b){return{title:"Link Properties",minWidth:400,minHeight:200,onShow:function(){},contents:[{id:"general",label:"Settings",elements:[{type:"html",html:"This dialog window lets you create and edit footnotes."},{type:"textarea",id:"contents",label:"Footnote Text (required)",validate:CKEDITOR.dialog.validate.notEmpty("The footnote text field cannot be empty."),commit:function(c){c.contents=this.getValue()},},{type:"hbox",id:"revisions",widths:["15%","30%","2%","53%"],children:[{type:"html",html:"Footnote Id: ",},{type:"text",id:"noteId",maxLength:"9",commit:function(c){c.noteId=this.getValue()},onChange:function(c){},},{type:"html",html:"&nbsp;&nbsp;",},{type:"button",label:"Load Note In Editor",id:"id3",onClick:function(){var e=this.getDialog();var f=e.getContentElement("general","noteId").getInputElement().$.id;var c=document.getElementById(f).value;if(c){if(oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[c]){var f=e.getContentElement("general","contents").getInputElement().$.id;var d=document.getElementById(f);d.value=oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[c]}}},}]},]}],onOk:function(){var f=this,g={},e=b.document.createElement("sup");this.commitContent(g);if(g.noteId){oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[g.noteId]=g.contents;return}e.setAttribute("class","dwfcknote ");var d=++oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.count;var c="fckgL"+d;e.setAttribute("class","dwfcknote "+c);oDokuWiki_FCKEditorInstance.oinsertHtmlCodeObj.notes[c]=g.contents;e.setHtml(c);b.insertElement(e)}}})}});